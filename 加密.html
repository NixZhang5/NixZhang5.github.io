<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>加密 | Xinping&#39;s Blog | 因为有了危机感，所以才会义无反顾。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Encryption">
    <meta name="description" content="加密是为了保证我们的数据安全，即不被他人篡改或截取到有用的信息的操作。iOS一直以安全著称，但是从Xcode的Ghost事件之后，iOS安全不可摧的神话似乎已经被打破。事实证明，无论是Android还是iOS，该加密处理的还是需要加密处理，谁也不能保证自己一定是安全的。">
<meta name="keywords" content="Encryption">
<meta property="og:type" content="article">
<meta property="og:title" content="加密">
<meta property="og:url" content="https://nixzhang5.github.io/加密.html">
<meta property="og:site_name" content="Xinping&#39;s Blog">
<meta property="og:description" content="加密是为了保证我们的数据安全，即不被他人篡改或截取到有用的信息的操作。iOS一直以安全著称，但是从Xcode的Ghost事件之后，iOS安全不可摧的神话似乎已经被打破。事实证明，无论是Android还是iOS，该加密处理的还是需要加密处理，谁也不能保证自己一定是安全的。">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-06-26T03:25:10.730Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="加密">
<meta name="twitter:description" content="加密是为了保证我们的数据安全，即不被他人篡改或截取到有用的信息的操作。iOS一直以安全著称，但是从Xcode的Ghost事件之后，iOS安全不可摧的神话似乎已经被打破。事实证明，无论是Android还是iOS，该加密处理的还是需要加密处理，谁也不能保证自己一定是安全的。">
    
        <link rel="alternate" type="application/atom+xml" title="Xinping&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">张新平</h5>
          <a href="mailto:351235445@qq.com" title="351235445@qq.com" class="mail">351235445@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/NixZhang5" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">加密</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">加密</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-06-26T02:27:44.000Z" itemprop="datePublished" class="page-time">
  2019-06-26
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/iOS/">iOS</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#对称加密"><span class="post-toc-number">1.</span> <span class="post-toc-text">对称加密</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#非对称加密"><span class="post-toc-number">2.</span> <span class="post-toc-text">非对称加密</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Hash算法（摘要算法）"><span class="post-toc-number">3.</span> <span class="post-toc-text">Hash算法（摘要算法）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数字签名"><span class="post-toc-number">4.</span> <span class="post-toc-text">数字签名</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#完整的非对称加密过程"><span class="post-toc-number">5.</span> <span class="post-toc-text">完整的非对称加密过程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#iOS常用的加密方式"><span class="post-toc-number">6.</span> <span class="post-toc-text">iOS常用的加密方式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Base64加密"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">Base64加密</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#MD5加密（MD5是一种摘要，而非加密，只是经常与加密配合使用）"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">MD5加密（MD5是一种摘要，而非加密，只是经常与加密配合使用）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#AES加密（对称加密的一种）"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">AES加密（对称加密的一种）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#RSA加密（非对称加密的一种）"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">RSA加密（非对称加密的一种）</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-加密"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">加密</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-06-26 10:27:44" datetime="2019-06-26T02:27:44.000Z"  itemprop="datePublished">2019-06-26</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/iOS/">iOS</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>加密是为了保证我们的数据安全，即不被他人篡改或截取到有用的信息的操作。iOS一直以安全著称，但是从Xcode的Ghost事件之后，iOS安全不可摧的神话似乎已经被打破。事实证明，无论是Android还是iOS，该加密处理的还是需要加密处理，谁也不能保证自己一定是安全的。</p>
<a id="more"></a>

<h3 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h3><p>A与 B 之间之间的通讯数据都用同一套的密钥来进行加密解密。</p>
<ul>
<li>优点<br>简单快捷，密钥较短，且破译困难。</li>
<li>缺点<br>如果用户一旦多的话，管理密钥也是一种困难。不方便直接沟通的两个用户之间怎么确定密钥也需要考虑，这其中就会有密钥泄露的风险，以及存在更换密钥的需求。</li>
</ul>
<p>对称加密通常有 AES, DES, IDEA, 3DES 加密算法。</p>
<h3 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h3><p>用公钥和私钥来加解密的算法。打个比方，A 的公钥加密过的东西只能通过 A 的私钥来解密；同理，A 的私钥加密过的东西只能通过 A 的公钥来解密。顾名思义，公钥是公开的，别人可以获取的到；私钥是私有的，只能自己拥有。</p>
<ul>
<li>缺点<br>加解密比对称加密耗时.</li>
<li>优点<br>比对称加密安全.</li>
</ul>
<p>但是非对称加密也是存在漏洞，因为公钥是公开的，如果有 C 冒充 B 的身份利用 A 的公钥给 A 发消息，这样就乱套了，所以接下来就采用<code>非对称加密+摘要算法+数字签名的机制</code>来确保传输安全。</p>
<p>常见的非对称加密算法有：RSA、ECC（移动设备用）、Diffie-Hellman、El Gamal、DSA（数字签名用）</p>
<h3 id="Hash算法（摘要算法）"><a href="#Hash算法（摘要算法）" class="headerlink" title="Hash算法（摘要算法）"></a>Hash算法（摘要算法）</h3><p>Hash算法的特点是单向不可还原，用户可以通过hash算法对目标信息生成一段特定长度的唯一hash值，却不能通过这个hash值重新获得目标信息。因此Hash算法常用在不可还原的密码存储、信息完整性校验等。只要源数据不同，算法得到的摘要必定不同。</p>
<p>常见的Hash算法有MD2、MD4、MD5、HAVAL、SHA</p>
<h3 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h3><p>数字签名用来，保证信息传输的完整性、发送者的身份认证、防止交易中的抵赖发生。</p>
<p>数字签名是 A将原始明文通过 hash 算法得到摘要，这个摘要是不可逆的；将明文加密，连同摘要一起发送给B；B接收到后解密，得到这个摘要 a 和加密的明文，再将加密明文解密得到原始明文，然后通过同一 hash 算法得到新的摘要 b，比较 a 与 b 就可得知在传输过程中是否被更改过。</p>
<p>因此数字签名能够验证信息的完整性。如果中途数据被纂改或者丢失。那么对方就可以根据数字签名来辨别是否是来自对方的第一手信息数据。</p>
<h3 id="完整的非对称加密过程"><a href="#完整的非对称加密过程" class="headerlink" title="完整的非对称加密过程"></a>完整的非对称加密过程</h3><p>假如现在 你向支付宝 转账（术语数据信息），为了保证信息传送的保密性、真实性、完整性和不可否认性，需要对传送的信息进行数字加密和签名，其传送过程为：</p>
<ol>
<li>首先你要确认是否是支付宝的数字证书，如果确认为支付宝身份后，则对方真实可信。可以向对方传送信息，</li>
<li>你准备好要传送的数字信息（明文）计算要转的多少钱，对方支付宝账号等；</li>
<li>你 对数字信息进行哈希运算，得到一个信息摘要（客户端主要职责）；</li>
<li>你 用自己的私钥对信息摘要进行加密得到 你 的数字签名，并将其附在数字信息上；</li>
<li>你 随机产生一个加密密钥，并用此密码对要发送的信息进行加密（密文）；</li>
<li>你用 支付宝的公钥对刚才随机产生的加密密钥进行加密，将加密后的 DES 密钥连同密文一起传送给支付宝；</li>
<li>支付宝收到 你 传送来的密文和加密过的 DES 密钥，先用自己的私钥对加密的 DES 密钥进行解密，得到 你随机产生的加密密钥；</li>
<li>支付宝 然后用随机密钥对收到的密文进行解密，得到明文的数字信息，然后将随机密钥抛弃；</li>
<li>支付宝 用你 的公钥对 你的的数字签名进行解密，得到信息摘要；</li>
<li>支付宝用相同的哈希算法对收到的明文再进行一次哈希运算，得到一个新的信息摘要；</li>
<li>支付宝将收到的信息摘要和新产生的信息摘要进行比较，如果一致，说明收到的信息没有被修改过。</li>
<li>确定收到信息，然后进行向对方进行付款交易，一次非对称密过程结束。在这后面的流程就不属于本次非对称加密的范畴，算支付宝个人的自我流程，也就是循环以上过程。</li>
</ol>
<h3 id="iOS常用的加密方式"><a href="#iOS常用的加密方式" class="headerlink" title="iOS常用的加密方式"></a>iOS常用的加密方式</h3><p>Base64加密、MD5加密、AES加密、RSA加密</p>
<h4 id="Base64加密"><a href="#Base64加密" class="headerlink" title="Base64加密"></a>Base64加密</h4><p>Base64编码的思想是：采用64个基本的ASCII码字符对数据进行重新编码。它将需要编码的数据拆分成字节数组，以3个字节为一组，按顺序排列24位数据，再把这24位数据分成4组，即每组6位；再在每组的的最高位前补两个0凑足一个字节，这样就把一个3字节为一组的数据重新编码成了4个字节；当所要编码的数据的字节数不是3的整倍数，也就是说在分组时最后一组不够3个字节，这时在最后一组填充1到2个0字节，并在最后编码完成后在结尾添加1到2个=号。例如：将对ABC进行Base64编码首先取ABC对应的ASCII码值，A : 65、B : 66、C : 67，再取二进制值A : 01000001、B : 01000010、C : 01000011，然后把这三个字节的二进制码接起来010000010100001001000011，再以6位为单位分成4个数据块并在最高位填充两个0后形成4个字节的编码后的值00010000、00010100、00001001、00000011；再把这4个字节数据转化成10进制数得16、20、19、3；最后根据Base64给出的64个基本字符表，查出对应的ASCII码字符Q、U、J、D，这里的值实际就是数据在字符表中的索引。解码过程就是把4个字节再还原成3个字节再根据不同的数据形式把字节数组重新整理成数据。注：Base64字符表，包括大写A-Z小写a-z数字0-9和+以及/。<br>Base64加密原则：6bit（原8bit）一个字节，不足的位数用0补齐，两个0用一个=表示。<br>Base64加密特点：</p>
<ul>
<li>数据加密之后，数据量会变大，变大1/3左右。</li>
<li>可进行反向解密。</li>
<li>编码后有个非常显著的特点，末尾有个=号。</li>
</ul>
<p>其实Base64不算是加密，只是一种编码格式。</p>
<p>在iOS中Base64加解密使用方法介绍（本例使用系统API，仅支持iOS7及以后的系统版本）</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************Base64.m类实现文件内容****************************/</span></span><br><span class="line">+ (<span class="built_in">NSString</span> *)base64EncodedStringWithData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断是否传入需要加密数据参数</span></span><br><span class="line">    <span class="keyword">if</span> ((data == <span class="literal">nil</span>) || (data == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![data isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断设备系统是否满足条件</span></span><br><span class="line">    <span class="keyword">if</span> ([[[<span class="built_in">UIDevice</span> currentDevice] systemVersion] doubleValue] &lt;= <span class="number">6.9</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//使用系统的API进行Base64加密操作</span></span><br><span class="line">    <span class="built_in">NSDataBase64EncodingOptions</span> options;</span><br><span class="line">    options = <span class="built_in">NSDataBase64EncodingEndLineWithLineFeed</span>;</span><br><span class="line">    <span class="keyword">return</span> [data base64EncodedStringWithOptions:options];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSData</span> *)base64DecodeDataWithString:(<span class="built_in">NSString</span> *)string</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断是否传入需要加密数据参数</span></span><br><span class="line">    <span class="keyword">if</span> ((string == <span class="literal">nil</span>) || (string == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![string isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断设备系统是否满足条件</span></span><br><span class="line">    <span class="keyword">if</span> ([[[<span class="built_in">UIDevice</span> currentDevice] systemVersion] doubleValue] &lt;= <span class="number">6.9</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//使用系统的API进行Base64解密操作</span></span><br><span class="line">    <span class="built_in">NSDataBase64DecodingOptions</span> options;</span><br><span class="line">    options = <span class="built_in">NSDataBase64DecodingIgnoreUnknownCharacters</span>;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="built_in">NSData</span> alloc] initWithBase64EncodedString:string options:options];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用Base64文件进行Base64加密和解密</span></span><br><span class="line"><span class="comment">/*********************************使用Base64类*********************************/</span></span><br><span class="line"><span class="comment">//使用Base64执行加密操作</span></span><br><span class="line"><span class="built_in">NSString</span> *string = <span class="string">@"abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line"><span class="built_in">NSData</span> *data = [string dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"><span class="built_in">NSString</span> *encodeString = [Base64 base64EncodedStringWithData:data];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"encodeString : %@"</span>, encodeString);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用Base64执行解密操作</span></span><br><span class="line"><span class="built_in">NSString</span> *decodeString = <span class="literal">nil</span>;</span><br><span class="line"><span class="built_in">NSData</span> *decodeData = [Base64 base64DecodeDataWithString:encodeString];</span><br><span class="line">decodeString = [[<span class="built_in">NSString</span> alloc] initWithData:decodeData</span><br><span class="line">                                     encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"decodeString : %@"</span>, decodeString);</span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br></pre></td></tr></table></figure>

<h4 id="MD5加密（MD5是一种摘要，而非加密，只是经常与加密配合使用）"><a href="#MD5加密（MD5是一种摘要，而非加密，只是经常与加密配合使用）" class="headerlink" title="MD5加密（MD5是一种摘要，而非加密，只是经常与加密配合使用）"></a>MD5加密（MD5是一种摘要，而非加密，只是经常与加密配合使用）</h4><p>MD5的全称是Message-DigestAlgorithm 5，Message-Digest泛指字节串(Message)的Hash变换，就是把一个任意长度的字节串变换成一定长的大整数。请注意我使用了字节串而不是字符串这个词，是因为这种变换只与字节的值有关，与字符集或编码方式无关。MD5将任意长度的字节串变换成一个128bit的大整数，并且它是一个不可逆的字符串变换算法，换句话说就是，即使你看到源程序和算法描述，也无法将一个MD5的值变换回原始的字符串，从数学原理上说，是因为原始的字符串有无穷多个，这有点象不存在反函数的数学函数。MD5的典型应用是对一段Message(字节串)产生fingerprint(指纹)，以防止被”篡改”。举个例子，你将一段话写在一个叫readme.txt文件中，并对这个readme.txt产生一个MD5的值并记录在案，然后你可以传播这个文件给别人，别人如果修改了文件中的任何内容，你对这个文件重新计算MD5时就会发现。如果再有一个第三方的认证机构，用MD5还可以防止文件作者的”抵赖”，这就是所谓的数字签名应用。MD5还广泛用于加密和解密技术上，在很多操作系统中，用户的密码是以MD5值（或类似的其它算法）的方式保存的，用户Login的时候，系统是把用户输入的密码计算成MD5值，然后再去和系统中保存的MD5值进行比较，而系统并”不知道”用户的密码是什么。MD5加密大体都应用在：验证数据或文件一致性、数字签名、安全访问认证等等。大概可比喻为：人的指纹来理解。<br>注：MD5加密是不可逆的，也就是说，MD5加密后是不能解密的，所谓的解密只是用大数据的”试用”，来测出结果的。<br>MD5特点:</p>
<ul>
<li>压缩性 : 任意长度的数据,算出的MD5值长度都是固定的。</li>
<li>容易计算 : 从原数据计算出MD5值很容易。</li>
<li>抗修改性 : 对原数据进行任何改动，哪怕只修改一个字节，所得到的MD5值都有很大区别。</li>
<li>弱抗碰撞 : 已知原数据和其MD5值，想找到一个具有相同MD5值的数据（即伪造数据）是非常困难的。</li>
<li>强抗碰撞 : 想找到两个不同数据，使他们具有相同的MD5值，是非常困难的。</li>
</ul>
<p>在iOS中MD5加密和验签使用方法介绍</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************MD5.m类实现文件内容****************************/</span></span><br><span class="line"><span class="comment">//对字符串数据进行MD5的签名</span></span><br><span class="line">+ (<span class="built_in">NSString</span> *)md5SignWithString:(<span class="built_in">NSString</span> *)string</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *object = [string UTF8String];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> result[CC_MD5_DIGEST_LENGTH];</span><br><span class="line">    CC_MD5(object,(CC_LONG)strlen(object),result);</span><br><span class="line">    <span class="built_in">NSMutableString</span> *hash = [<span class="built_in">NSMutableString</span> string];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i ++) &#123;</span><br><span class="line">        [hash appendFormat:<span class="string">@"%02X"</span>, result[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [hash lowercaseString];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//对二进制数据进行MD5的签名</span></span><br><span class="line">+ (<span class="built_in">NSData</span> *)md5SignWithData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">&#123;</span><br><span class="line">    Byte byte[CC_MD5_DIGEST_LENGTH];    <span class="comment">//定义一个字节数组来接收结果</span></span><br><span class="line">    CC_MD5((<span class="keyword">const</span> <span class="keyword">void</span>*)([data bytes]), (CC_LONG)[data length], byte);</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSData</span> dataWithBytes:byte length:CC_MD5_DIGEST_LENGTH];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用MD5文件进行MD5加密和验签</span></span><br><span class="line"><span class="comment">/*********************************使用MD5类*********************************/</span></span><br><span class="line"><span class="comment">//使用MD5执行加密操作</span></span><br><span class="line"><span class="built_in">NSString</span> *string2 = <span class="string">@"abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line"><span class="built_in">NSString</span> *encodeString2 = [MD5 md5SignWithString:string2];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"encodeString2 : %@"</span>, encodeString2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//MD5为不可逆的操作，使用MD5执行验签操作</span></span><br><span class="line"><span class="built_in">NSString</span> *verifyString2 = [MD5 md5SignWithString:string2];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"verifyString2 : %@"</span>, verifyString2);</span><br><span class="line"><span class="keyword">if</span> ([verifyString2 isEqualToString:encodeString2]) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"md5 verify sign success"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"md5 verify sign failed"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br></pre></td></tr></table></figure>

<h4 id="AES加密（对称加密的一种）"><a href="#AES加密（对称加密的一种）" class="headerlink" title="AES加密（对称加密的一种）"></a>AES加密（对称加密的一种）</h4><p>高级加密标准Advanced Encryption Standard简称：AES，在密码学中又称Rijndael加密法，是美国联邦政府采用的一种区块加密标准。它是一种对称加密算法，这个标准也替代原先的DES标准，已经被多方分析且广为全世界所使用。AES设计有三个密钥长度:128、192、256位，相对而言，AES的128密钥比DES的56密钥强1021倍。AES算法主要包括三个方面：轮变化、圈数和密钥扩展。总体来说，AES作为新一代的数据加密标准汇聚了强安全性、高性能、高效率、易用和灵活，在软件及硬件上都能快速地加解密且只需要很少的存储资源等优点。</p>
<p>AES加解密特点：</p>
<ul>
<li>AES强安全性、高性能、高效率、易用和灵活。</li>
<li>在软件及硬件上都能快速地加解密且只需要很少的存储资源。</li>
</ul>
<p>AES加密需要的参数：</p>
<ul>
<li><strong>密钥长度（Key Size）</strong><br>AES算法下，key的长度有三种：128、192和256 bits。由于历史原因，JDK默认只支持不大于128 bits的密钥，而128 bits的key已能够满足商用安全需求。因此本例先使用AES-128。（Java使用大于128 bits的key方法在文末提及）</li>
<li><strong>加密模式（Cipher Mode）</strong><br>AES属于块加密（Block Cipher），块加密中有CBC、ECB、CTR、OFB、CFB等几种工作模式。本例统一使用CBC模式。</li>
<li><strong>填充方式（Padding）</strong><br>由于块加密只能对特定长度的数据块进行加密，因此CBC、ECB模式需要在最后一数据块加密前进行数据填充。（CFB，OFB和CTR模式由于与key进行加密操作的是上一块加密后的密文，因此不需要对最后一段明文进行填充）<br>在iOS SDK中提供了PKCS7Padding，而JDK则提供了PKCS5Padding。原则上PKCS5Padding限制了填充的Block Size为8 bytes，而Java实际上当块大于该值时，其PKCS5Padding与PKCS7Padding是相等的：每需要填充χ个字节，填充的值就是χ。</li>
<li><strong>初始向量（Initialization Vector）</strong><br>使用除ECB以外的其他加密模式均需要传入一个初始向量，其大小与Block Size相等（AES的Block Size为128 bits），而两个平台的API文档均指明当不传入初始向量时，系统将默认使用一个全0的初始向量。<br>有了上述的基础之后，可以开始分别在两个平台进行实现了。</li>
</ul>
<p>在iOS中AES加解密的实现介绍</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需要导入：#import &lt;CommonCrypto/CommonCrypto.h&gt;库才能使用</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  AES128 + ECB + PKCS7</span></span><br><span class="line"><span class="comment"> *  @param data 要加密的原始数据</span></span><br><span class="line"><span class="comment"> *  @param key  加密 key</span></span><br><span class="line"><span class="comment"> *  @return  加密后数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">+ (<span class="built_in">NSData</span> *)encryptData:(<span class="built_in">NSData</span> *)data key:(<span class="built_in">NSData</span> *)key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断解密的流数据是否存在</span></span><br><span class="line">    <span class="keyword">if</span> ((data == <span class="literal">nil</span>) || (data == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![data isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([data length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断解密的Key是否存在</span></span><br><span class="line">    <span class="keyword">if</span> ((key == <span class="literal">nil</span>) || (key == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![key isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([key length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//setup key</span></span><br><span class="line">    <span class="built_in">NSData</span> *result = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> cKey[kCCKeySizeAES128];</span><br><span class="line">    bzero(cKey, <span class="keyword">sizeof</span>(cKey));</span><br><span class="line">    [key getBytes:cKey length:kCCKeySizeAES128];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//setup output buffer</span></span><br><span class="line">    size_t bufferSize = [data length] + kCCBlockSizeAES128;</span><br><span class="line">    <span class="keyword">void</span> *buffer = malloc(bufferSize);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//do encrypt</span></span><br><span class="line">    size_t encryptedSize = <span class="number">0</span>;</span><br><span class="line">    CCCryptorStatus cryptStatus = CCCrypt(kCCEncrypt,</span><br><span class="line">                                          kCCAlgorithmAES128,</span><br><span class="line">                                          kCCOptionECBMode|kCCOptionPKCS7Padding,</span><br><span class="line">                                          cKey,</span><br><span class="line">                                          kCCKeySizeAES128,</span><br><span class="line">                                          <span class="literal">nil</span>,</span><br><span class="line">                                          [data bytes],</span><br><span class="line">                                          [data length],</span><br><span class="line">                                          buffer,</span><br><span class="line">                                          bufferSize,</span><br><span class="line">                                          &amp;encryptedSize);</span><br><span class="line">    <span class="keyword">if</span> (cryptStatus == kCCSuccess) &#123;</span><br><span class="line">        result = [<span class="built_in">NSData</span> dataWithBytesNoCopy:buffer length:encryptedSize];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        free(buffer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  AES128 + ECB + PKCS7</span></span><br><span class="line"><span class="comment"> *  @param data 要解密的原始数据</span></span><br><span class="line"><span class="comment"> *  @param key  解密 key</span></span><br><span class="line"><span class="comment"> *  @return  解密后数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">+ (<span class="built_in">NSData</span> *)decryptData:(<span class="built_in">NSData</span> *)data key:(<span class="built_in">NSData</span> *)key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断解密的流数据是否存在</span></span><br><span class="line">    <span class="keyword">if</span> ((data == <span class="literal">nil</span>) || (data == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![data isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([data length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断解密的Key是否存在</span></span><br><span class="line">    <span class="keyword">if</span> ((key == <span class="literal">nil</span>) || (key == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![key isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([key length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//setup key</span></span><br><span class="line">    <span class="built_in">NSData</span> *result = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> cKey[kCCKeySizeAES128];</span><br><span class="line">    bzero(cKey, <span class="keyword">sizeof</span>(cKey));</span><br><span class="line">    [key getBytes:cKey length:kCCKeySizeAES128];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//setup output buffer</span></span><br><span class="line">    size_t bufferSize = [data length] + kCCBlockSizeAES128;</span><br><span class="line">    <span class="keyword">void</span> *buffer = malloc(bufferSize);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//do decrypt</span></span><br><span class="line">    size_t decryptedSize = <span class="number">0</span>;</span><br><span class="line">    CCCryptorStatus cryptStatus = CCCrypt(kCCDecrypt,</span><br><span class="line">                                          kCCAlgorithmAES128,</span><br><span class="line">                                          kCCOptionECBMode|kCCOptionPKCS7Padding,</span><br><span class="line">                                          cKey,</span><br><span class="line">                                          kCCKeySizeAES128,</span><br><span class="line">                                          <span class="literal">nil</span>,</span><br><span class="line">                                          [data bytes],</span><br><span class="line">                                          [data length],</span><br><span class="line">                                          buffer,</span><br><span class="line">                                          bufferSize,</span><br><span class="line">                                          &amp;decryptedSize);</span><br><span class="line">    <span class="keyword">if</span> (cryptStatus == kCCSuccess) &#123;</span><br><span class="line">        result = [<span class="built_in">NSData</span> dataWithBytesNoCopy:buffer length:decryptedSize];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        free(buffer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在iOS中AES加解密使用方法介绍</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用AES执行加密操作</span></span><br><span class="line"><span class="built_in">NSString</span> *aesKey = <span class="string">@"a1b2c3d4e5f6g7h8"</span>;</span><br><span class="line"><span class="built_in">NSString</span> *string3 = <span class="string">@"abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line"><span class="built_in">NSData</span> *keyData3 = [aesKey dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"><span class="built_in">NSData</span> *sourceData3 = [string3 dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"><span class="built_in">NSData</span> *encodeData3 = [AESEncrypt encryptData:sourceData3 key:keyData3];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"encodeData3 : %@"</span>, encodeData3);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用AES执行解密操作</span></span><br><span class="line"><span class="built_in">NSString</span> *decodeString3 = <span class="literal">nil</span>;</span><br><span class="line"><span class="built_in">NSData</span> *decodeData3 = [AESEncrypt decryptData:encodeData3</span><br><span class="line">                                          key:keyData3];</span><br><span class="line">decodeString3 = [[<span class="built_in">NSString</span> alloc] initWithData:decodeData3</span><br><span class="line">                                      encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"decodeString3 : %@"</span>, decodeString3);</span><br></pre></td></tr></table></figure>

<h4 id="RSA加密（非对称加密的一种）"><a href="#RSA加密（非对称加密的一种）" class="headerlink" title="RSA加密（非对称加密的一种）"></a>RSA加密（非对称加密的一种）</h4><p>RSA是目前最有影响力的公钥加密算法，它能够抵抗到目前为止已知的绝大多数密码攻击，已被ISO推荐为公钥数据加密标准。RSA的公开密钥密码体制就是使用不同的加密密钥与解密密钥，是一种“由已知加密密钥推导出解密密钥在计算上是不可行的”密码体制。通常是先生成一对RSA密钥，其中之一是保密密钥，由用户保存；另一个为公开密钥，可对外公开，甚至可在网络服务器中注册。为提高保密强度，RSA密钥至少为500位长，一般推荐使用1024位，这就使加密的计算量很大。为减少计算量，在传送信息时，常采用传统加密方法与公开密钥加密方法相结合的方式，即信息采用改进的DES或IDEA对话密钥加密，然后使用RSA密钥加密对话密钥和信息摘要，对方收到信息后，用不同的密钥解密并可核对信息摘要。RSA算法是第一个能同时用于加密和数字签名的算法，也易于理解和操作，RSA是被研究得最广泛的公钥算法。RSA算法是一种非对称密码算法，所谓非对称，就是指该算法需要一对密钥，使用其中一个加密，则需要用另一个才能解密。RSA加密大体都应用在：本地数据加密、网络传输数据加密、方法体和方法名高级混淆以及程序结构混排加密。例如：对客户端传输数据提供加密方案，有效防止通过网络接口的拦截获取。</p>
<p>RSA的算法涉及三个参数，n、e1、e2。其中，n是两个大质数p、q的积，n的二进制表示时所占用的位数，就是所谓的密钥长度。e1和e2是一对相关的值，e1可以任意取，但要求e1与(p-1)(q-1)互质；再选择e2，要求(e2e1)mod((p-1)*(q-1))=1。(n，e1)，(n，e2)就是密钥对。其中(n，e1)为公钥，(n，e2)为私钥；RSA加解密的算法完全相同，公钥加密体制中，一般用公钥加密，私钥解密。假设A为明文，B为密文，则：A=B^e2 mod n；B=A^e1 mod n；e1和e2可以互换使用，即私钥加密，公钥解密，公式：A=B^e1 mod n；B=A^e2 mod n;</p>
<p>RSA加解密特点：</p>
<ul>
<li>RSA密钥管理的方便，计算量很大速度相对比较慢。</li>
<li>RSA安全性很高，能够抵抗到目前为止已知的绝大多数密码攻击。<br>在线生成RSA密钥对的网址：在线生成非对称加密公钥私钥对等，RSA密钥格式请使用PKCS#8格式。PKCS#1与PKCS#8的区别还待后续查阅资料，再进行补充记录。</li>
</ul>
<p>在iOS中RSA加解密的实现介绍（支持密钥文件&lt;.pem&gt;和字符串密钥）</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************RSAEncrypt.m类实现文件内容****************************/</span></span><br><span class="line"><span class="meta">#pragma mark - Class Utils Method</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)isEmptyKeyRef:(<span class="keyword">id</span>)object</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (object == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (object == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (object == [<span class="built_in">NSNull</span> null]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Private Method</span></span><br><span class="line">+ (SecKeyRef)getPrivateKeyRefWithFilePath:(<span class="built_in">NSString</span> *)filePath keyPassword:(<span class="built_in">NSString</span> *)keyPassword</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//读取私钥证书文件的内容</span></span><br><span class="line">    <span class="built_in">NSData</span> *certificateData = [<span class="built_in">NSData</span> dataWithContentsOfFile:filePath];</span><br><span class="line">    <span class="keyword">if</span> ((certificateData == <span class="literal">nil</span>) || (certificateData == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![certificateData isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([certificateData length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//拼接密码参数到字典中</span></span><br><span class="line">    <span class="built_in">NSString</span> *passwordKey = (__bridge <span class="keyword">id</span>)kSecImportExportPassphrase;</span><br><span class="line">    <span class="built_in">NSString</span> *passwordValue = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@"</span>,keyPassword];</span><br><span class="line">    <span class="keyword">if</span> ((keyPassword == <span class="literal">nil</span>) || (keyPassword == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        passwordValue = <span class="string">@""</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![keyPassword isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        passwordValue = <span class="string">@""</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPassword length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        passwordValue = <span class="string">@""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *optionInfo = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</span><br><span class="line">    [optionInfo setObject:passwordValue forKey:passwordKey];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取私钥对象</span></span><br><span class="line">    SecKeyRef privateKeyRef = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="built_in">CFArrayRef</span> items = <span class="built_in">CFArrayCreate</span>(<span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">CFDataRef</span> pkcs12Data = (__bridge <span class="built_in">CFDataRef</span>)certificateData;</span><br><span class="line">    <span class="built_in">CFDictionaryRef</span> options = (__bridge <span class="built_in">CFDictionaryRef</span>)optionInfo;</span><br><span class="line">    OSStatus securityStatus = SecPKCS12Import(pkcs12Data, options, &amp;items);</span><br><span class="line">    <span class="keyword">if</span> (securityStatus == noErr &amp;&amp; <span class="built_in">CFArrayGetCount</span>(items) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        SecIdentityRef identity;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">void</span> *secpkey = kSecImportItemIdentity;</span><br><span class="line">        <span class="built_in">CFDictionaryRef</span> identityDict = <span class="built_in">CFArrayGetValueAtIndex</span>(items, <span class="number">0</span>);</span><br><span class="line">        identity = (SecIdentityRef)<span class="built_in">CFDictionaryGetValue</span>(identityDict,secpkey);</span><br><span class="line">        securityStatus = SecIdentityCopyPrivateKey(identity, &amp;privateKeyRef);</span><br><span class="line">        <span class="keyword">if</span> (securityStatus != noErr)</span><br><span class="line">        &#123;</span><br><span class="line">            privateKeyRef = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CFRelease</span>(items);</span><br><span class="line">    <span class="keyword">return</span> privateKeyRef;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (SecKeyRef)privateKeyRefWithPrivateKey:(<span class="built_in">NSString</span> *)privateKey</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((privateKey == <span class="literal">nil</span>) || (privateKey == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![privateKey isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([privateKey length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//解析私钥对象内容</span></span><br><span class="line">    <span class="built_in">NSString</span> *pKey = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@"</span>,privateKey];</span><br><span class="line">    <span class="built_in">NSRange</span> sposition = [pKey rangeOfString:<span class="string">@"-----BEGIN RSA PRIVATE KEY-----"</span>];</span><br><span class="line">    <span class="built_in">NSRange</span> eposition = [pKey rangeOfString:<span class="string">@"-----END RSA PRIVATE KEY-----"</span>];</span><br><span class="line">    <span class="keyword">if</span> (sposition.location != <span class="built_in">NSNotFound</span> &amp;&amp; eposition.location != <span class="built_in">NSNotFound</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">NSUInteger</span> endposition = eposition.location;</span><br><span class="line">        <span class="built_in">NSUInteger</span> startposition = sposition.location + sposition.length;</span><br><span class="line">        <span class="built_in">NSRange</span> range = <span class="built_in">NSMakeRange</span>(startposition, endposition-startposition);</span><br><span class="line">        pKey = [pKey substringWithRange:range];</span><br><span class="line">    &#125;</span><br><span class="line">    pKey = [pKey stringByReplacingOccurrencesOfString:<span class="string">@"\r"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    pKey = [pKey stringByReplacingOccurrencesOfString:<span class="string">@"\n"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    pKey = [pKey stringByReplacingOccurrencesOfString:<span class="string">@"\t"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    pKey = [pKey stringByReplacingOccurrencesOfString:<span class="string">@" "</span>  withString:<span class="string">@""</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//This will be base64 encoded, decode it.</span></span><br><span class="line">    <span class="built_in">NSData</span> *keyData = [Base64 base64DecodeDataWithString:pKey];</span><br><span class="line">    keyData = [<span class="keyword">self</span> stripPrivateKeyHeader:keyData];</span><br><span class="line">    <span class="keyword">if</span> ((keyData == <span class="literal">nil</span>) || (keyData == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![keyData isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyData length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//a tag to read/write keychain storage</span></span><br><span class="line">    <span class="built_in">NSString</span> *tag = <span class="string">@"RSAUtil_PrivKey"</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">void</span> *bytes = [tag UTF8String];</span><br><span class="line">    <span class="built_in">NSData</span> *tagData = [<span class="built_in">NSData</span> dataWithBytes:bytes length:[tag length]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Delete any old lingering key with the same tag</span></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *attributes = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</span><br><span class="line">    [attributes setObject:(__bridge <span class="keyword">id</span>)kSecClassKey</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecClass];</span><br><span class="line">    [attributes setObject:(__bridge <span class="keyword">id</span>)kSecAttrKeyTypeRSA</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecAttrKeyType];</span><br><span class="line">    [attributes setObject:tagData</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecAttrApplicationTag];</span><br><span class="line">    SecItemDelete((__bridge <span class="built_in">CFDictionaryRef</span>)attributes);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Add persistent version of the key to system keychain</span></span><br><span class="line">    [attributes setObject:keyData forKey:(__bridge <span class="keyword">id</span>)kSecValueData];</span><br><span class="line">    [attributes setObject:(__bridge <span class="keyword">id</span>)kSecAttrKeyClassPrivate</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecAttrKeyClass];</span><br><span class="line">    [attributes setObject:[<span class="built_in">NSNumber</span> numberWithBool:<span class="literal">YES</span>]</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecReturnPersistentRef];</span><br><span class="line">    </span><br><span class="line">    OSStatus status = noErr;</span><br><span class="line">    <span class="built_in">CFTypeRef</span> persistKey = <span class="literal">nil</span>;</span><br><span class="line">    status = SecItemAdd((__bridge <span class="built_in">CFDictionaryRef</span>)attributes, &amp;persistKey);</span><br><span class="line">    <span class="keyword">if</span> (persistKey != <span class="literal">nil</span>) &#123;<span class="built_in">CFRelease</span>(persistKey);&#125;</span><br><span class="line">    <span class="keyword">if</span> ((status != noErr) &amp;&amp; (status != errSecDuplicateItem))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [attributes removeObjectForKey:(__bridge <span class="keyword">id</span>)kSecValueData];</span><br><span class="line">    [attributes removeObjectForKey:(__bridge <span class="keyword">id</span>)kSecReturnPersistentRef];</span><br><span class="line">    [attributes setObject:[<span class="built_in">NSNumber</span> numberWithBool:<span class="literal">YES</span>]</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecReturnRef];</span><br><span class="line">    [attributes setObject:(__bridge <span class="keyword">id</span>)kSecAttrKeyTypeRSA</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecAttrKeyType];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Now fetch the SecKeyRef version of the key</span></span><br><span class="line">    SecKeyRef keyRef = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">CFDictionaryRef</span> query = (__bridge <span class="built_in">CFDictionaryRef</span>)attributes;</span><br><span class="line">    status = SecItemCopyMatching(query, (<span class="built_in">CFTypeRef</span> *)&amp;keyRef);</span><br><span class="line">    <span class="keyword">if</span> (status != noErr)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> keyRef;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSData</span> *)stripPrivateKeyHeader:(<span class="built_in">NSData</span> *)d_key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//Skip ASN.1 private key header</span></span><br><span class="line">    <span class="keyword">if</span> (d_key == <span class="literal">nil</span>) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> len = [d_key length];</span><br><span class="line">    <span class="keyword">if</span> (!len) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *c_key = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)[d_key bytes];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> idx = <span class="number">22</span>; <span class="comment">//magic byte at offset 22</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0x04</span> != c_key[idx++]) <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//calculate length of the key</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> c_len = c_key[idx++];</span><br><span class="line">    <span class="keyword">if</span> (!(c_len &amp; <span class="number">0x80</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        c_len = c_len &amp; <span class="number">0x7f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> byteCount = c_len &amp; <span class="number">0x7f</span>;</span><br><span class="line">        <span class="keyword">if</span> (byteCount + idx &gt; len) &#123;</span><br><span class="line">            <span class="comment">//rsa length field longer than buffer</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> accum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> *ptr = &amp;c_key[idx];</span><br><span class="line">        idx += byteCount;</span><br><span class="line">        <span class="keyword">while</span> (byteCount) &#123;</span><br><span class="line">            accum = (accum &lt;&lt; <span class="number">8</span>) + *ptr;</span><br><span class="line">            ptr++;</span><br><span class="line">            byteCount--;</span><br><span class="line">        &#125;</span><br><span class="line">        c_len = accum;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Now make a new NSData from this buffer</span></span><br><span class="line">    <span class="keyword">return</span> [d_key subdataWithRange:<span class="built_in">NSMakeRange</span>(idx, c_len)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (SecKeyRef)getPublicKeyRefWithFilePath:(<span class="built_in">NSString</span> *)filePath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//读取公钥证书文件的内容</span></span><br><span class="line">    <span class="built_in">NSData</span> *certificateData = [<span class="built_in">NSData</span> dataWithContentsOfFile:filePath];</span><br><span class="line">    <span class="keyword">if</span> ((certificateData == <span class="literal">nil</span>) || (certificateData == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![certificateData isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([certificateData length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将公钥证书制作成证书对象</span></span><br><span class="line">    <span class="built_in">CFDataRef</span> data = (__bridge <span class="built_in">CFDataRef</span>)certificateData;</span><br><span class="line">    SecCertificateRef certificateRef = SecCertificateCreateWithData(<span class="literal">NULL</span>, data);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取公钥对象</span></span><br><span class="line">    SecTrustRef trust = <span class="literal">NULL</span>;</span><br><span class="line">    SecKeyRef publicKey = <span class="literal">NULL</span>;</span><br><span class="line">    SecPolicyRef policies = SecPolicyCreateBasicX509();</span><br><span class="line">    <span class="keyword">if</span> (![[<span class="keyword">self</span> <span class="keyword">class</span>] isEmptyKeyRef:(__bridge <span class="keyword">id</span>)(certificateRef)]</span><br><span class="line">        &amp;&amp; ![[<span class="keyword">self</span> <span class="keyword">class</span>] isEmptyKeyRef:(__bridge <span class="keyword">id</span>)(policies)])</span><br><span class="line">    &#123;</span><br><span class="line">        OSStatus status;</span><br><span class="line">        status = SecTrustCreateWithCertificates((<span class="built_in">CFTypeRef</span>)certificateRef,</span><br><span class="line">                                                policies, &amp;trust);</span><br><span class="line">        <span class="keyword">if</span> (status == noErr)</span><br><span class="line">        &#123;</span><br><span class="line">            SecTrustResultType result;</span><br><span class="line">            <span class="keyword">if</span> (SecTrustEvaluate(trust, &amp;result) == noErr)</span><br><span class="line">            &#123;</span><br><span class="line">                publicKey = SecTrustCopyPublicKey(trust);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (certificateRef != <span class="literal">NULL</span>) <span class="built_in">CFRelease</span>(certificateRef);</span><br><span class="line">    <span class="keyword">if</span> (policies != <span class="literal">NULL</span>) <span class="built_in">CFRelease</span>(policies);</span><br><span class="line">    <span class="keyword">if</span> (trust != <span class="literal">NULL</span>) <span class="built_in">CFRelease</span>(trust);</span><br><span class="line">    <span class="keyword">return</span> publicKey;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (SecKeyRef)publicKeyRefWithPublicKey:(<span class="built_in">NSString</span> *)publicKey</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((publicKey == <span class="literal">nil</span>) || (publicKey == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![publicKey isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([publicKey length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//解析公钥对象内容</span></span><br><span class="line">    <span class="built_in">NSString</span> *pKey = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@"</span>,publicKey];</span><br><span class="line">    <span class="built_in">NSRange</span> sposition = [pKey rangeOfString:<span class="string">@"-----BEGIN PUBLIC KEY-----"</span>];</span><br><span class="line">    <span class="built_in">NSRange</span> eposition = [pKey rangeOfString:<span class="string">@"-----END PUBLIC KEY-----"</span>];</span><br><span class="line">    <span class="keyword">if</span> (sposition.location != <span class="built_in">NSNotFound</span> &amp;&amp; eposition.location != <span class="built_in">NSNotFound</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">NSUInteger</span> startposition = eposition.location;</span><br><span class="line">        <span class="built_in">NSUInteger</span> endposition = sposition.location + sposition.length;</span><br><span class="line">        <span class="built_in">NSRange</span> range = <span class="built_in">NSMakeRange</span>(endposition, startposition-endposition);</span><br><span class="line">        pKey = [pKey substringWithRange:range];</span><br><span class="line">    &#125;</span><br><span class="line">    pKey = [pKey stringByReplacingOccurrencesOfString:<span class="string">@"\r"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    pKey = [pKey stringByReplacingOccurrencesOfString:<span class="string">@"\n"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    pKey = [pKey stringByReplacingOccurrencesOfString:<span class="string">@"\t"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    pKey = [pKey stringByReplacingOccurrencesOfString:<span class="string">@" "</span>  withString:<span class="string">@""</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//This will be base64 encoded, decode it.</span></span><br><span class="line">    <span class="built_in">NSData</span> *keyData = [[<span class="keyword">self</span> <span class="keyword">class</span>] base64DecodeDataWithString:pKey];</span><br><span class="line">    keyData = [<span class="keyword">self</span> stripPublicKeyHeader:keyData];</span><br><span class="line">    <span class="keyword">if</span> ((keyData == <span class="literal">nil</span>) || (keyData == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![keyData isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyData length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//a tag to read/write keychain storage</span></span><br><span class="line">    <span class="built_in">NSString</span> *tag = <span class="string">@"RSAUtil_PubKey"</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">void</span> *bytes = [tag UTF8String];</span><br><span class="line">    <span class="built_in">NSData</span> *tagData = [<span class="built_in">NSData</span> dataWithBytes:bytes length:[tag length]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Delete any old lingering key with the same tag</span></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *attributes = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</span><br><span class="line">    [attributes setObject:(__bridge <span class="keyword">id</span>)kSecClassKey</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecClass];</span><br><span class="line">    [attributes setObject:(__bridge <span class="keyword">id</span>)kSecAttrKeyTypeRSA</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecAttrKeyType];</span><br><span class="line">    [attributes setObject:tagData</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecAttrApplicationTag];</span><br><span class="line">    SecItemDelete((__bridge <span class="built_in">CFDictionaryRef</span>)attributes);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Add persistent version of the key to system keychain</span></span><br><span class="line">    [attributes setObject:keyData</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecValueData];</span><br><span class="line">    [attributes setObject:(__bridge <span class="keyword">id</span>)kSecAttrKeyClassPublic</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecAttrKeyClass];</span><br><span class="line">    [attributes setObject:[<span class="built_in">NSNumber</span> numberWithBool:<span class="literal">YES</span>]</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecReturnPersistentRef];</span><br><span class="line">    </span><br><span class="line">    OSStatus status = noErr;</span><br><span class="line">    <span class="built_in">CFTypeRef</span> persistKey = <span class="literal">nil</span>;</span><br><span class="line">    status = SecItemAdd((__bridge <span class="built_in">CFDictionaryRef</span>)attributes, &amp;persistKey);</span><br><span class="line">    <span class="keyword">if</span> (persistKey != <span class="literal">nil</span>) <span class="built_in">CFRelease</span>(persistKey);</span><br><span class="line">    <span class="keyword">if</span> ((status != noErr) &amp;&amp; (status != errSecDuplicateItem))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    [attributes removeObjectForKey:(__bridge <span class="keyword">id</span>)kSecValueData];</span><br><span class="line">    [attributes removeObjectForKey:(__bridge <span class="keyword">id</span>)kSecReturnPersistentRef];</span><br><span class="line">    [attributes setObject:[<span class="built_in">NSNumber</span> numberWithBool:<span class="literal">YES</span>]</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecReturnRef];</span><br><span class="line">    [attributes setObject:(__bridge <span class="keyword">id</span>)kSecAttrKeyTypeRSA</span><br><span class="line">                   forKey:(__bridge <span class="keyword">id</span>)kSecAttrKeyType];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Now fetch the SecKeyRef version of the key</span></span><br><span class="line">    SecKeyRef publicKeyRef = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">CFDictionaryRef</span> query = (__bridge <span class="built_in">CFDictionaryRef</span>)attributes;</span><br><span class="line">    status = SecItemCopyMatching(query, (<span class="built_in">CFTypeRef</span> *)&amp;publicKeyRef);</span><br><span class="line">    <span class="keyword">if</span> (status != noErr)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> publicKeyRef;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSData</span> *)stripPublicKeyHeader:(<span class="built_in">NSData</span> *)d_key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//Skip ASN.1 public key header</span></span><br><span class="line">    <span class="keyword">if</span> (d_key == <span class="literal">nil</span>) &#123;<span class="keyword">return</span> <span class="literal">nil</span>;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> len = [d_key length];</span><br><span class="line">    <span class="keyword">if</span> (!len) <span class="keyword">return</span>(<span class="literal">nil</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *c_key = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)[d_key bytes];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (c_key[idx++] != <span class="number">0x30</span>) &#123;<span class="keyword">return</span> <span class="literal">nil</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span> (c_key[idx] &gt; <span class="number">0x80</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        idx += c_key[idx] - <span class="number">0x80</span> + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        idx++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//PKCS #1 rsaEncryption szOID_RSA_RSA</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> seqiod[] = &#123;<span class="number">0x30</span>, <span class="number">0x0d</span>, <span class="number">0x06</span>, <span class="number">0x09</span>, <span class="number">0x2a</span>,</span><br><span class="line">        <span class="number">0x86</span>, <span class="number">0x48</span>, <span class="number">0x86</span>, <span class="number">0xf7</span>, <span class="number">0x0d</span>,</span><br><span class="line">        <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0x00</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (memcmp(&amp;c_key[idx], seqiod, <span class="number">15</span>)) &#123;<span class="keyword">return</span> <span class="literal">nil</span>;&#125;</span><br><span class="line">    idx += <span class="number">15</span>;</span><br><span class="line">    <span class="keyword">if</span> (c_key[idx++] != <span class="number">0x03</span>) &#123;<span class="keyword">return</span> <span class="literal">nil</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span> (c_key[idx] &gt; <span class="number">0x80</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        idx += c_key[idx] - <span class="number">0x80</span> + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        idx ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (c_key[idx++] != <span class="string">'\0'</span>) &#123;<span class="keyword">return</span> <span class="literal">nil</span>;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Now make a new NSData from this buffer</span></span><br><span class="line">    <span class="keyword">return</span> ([<span class="built_in">NSData</span> dataWithBytes:&amp;c_key[idx] length:len - idx]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSData</span> *)encryptData:(<span class="built_in">NSData</span> *)data withKeyRef:(SecKeyRef)keyRef</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> uint8_t *srcbuf = (<span class="keyword">const</span> uint8_t *)[data bytes];</span><br><span class="line">    size_t srclen = (size_t)data.length;</span><br><span class="line">    </span><br><span class="line">    size_t block_size = SecKeyGetBlockSize(keyRef) * <span class="keyword">sizeof</span>(uint8_t);</span><br><span class="line">    <span class="keyword">void</span> *outbuf = malloc(block_size);</span><br><span class="line">    size_t src_block_size = block_size - <span class="number">11</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSMutableData</span> *ret = [[<span class="built_in">NSMutableData</span> alloc] init];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> idx = <span class="number">0</span>; idx &lt; srclen; idx += src_block_size)</span><br><span class="line">    &#123;</span><br><span class="line">        size_t data_len = srclen - idx;</span><br><span class="line">        <span class="keyword">if</span>(data_len &gt; src_block_size)&#123;</span><br><span class="line">            data_len = src_block_size;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        size_t outlen = block_size;</span><br><span class="line">        OSStatus status = noErr;</span><br><span class="line">        status = SecKeyEncrypt(keyRef, kSecPaddingPKCS1,</span><br><span class="line">                               srcbuf + idx, data_len,</span><br><span class="line">                               outbuf, &amp;outlen);</span><br><span class="line">        <span class="keyword">if</span> (status != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"SecKeyEncrypt fail. Error Code: %d"</span>, (<span class="keyword">int</span>)status);</span><br><span class="line">            ret = <span class="literal">nil</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            [ret appendBytes:outbuf length:outlen];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    free(outbuf);</span><br><span class="line">    <span class="built_in">CFRelease</span>(keyRef);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSData</span> *)decryptData:(<span class="built_in">NSData</span> *)data withKeyRef:(SecKeyRef)keyRef</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> uint8_t *srcbuf = (<span class="keyword">const</span> uint8_t *)[data bytes];</span><br><span class="line">    size_t srclen = (size_t)data.length;</span><br><span class="line">    </span><br><span class="line">    size_t block_size = SecKeyGetBlockSize(keyRef) * <span class="keyword">sizeof</span>(uint8_t);</span><br><span class="line">    <span class="built_in">UInt8</span> *outbuf = malloc(block_size);</span><br><span class="line">    size_t src_block_size = block_size;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSMutableData</span> *ret = [[<span class="built_in">NSMutableData</span> alloc] init];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> idx = <span class="number">0</span>; idx &lt; srclen; idx += src_block_size)</span><br><span class="line">    &#123;</span><br><span class="line">        size_t data_len = srclen - idx;</span><br><span class="line">        <span class="keyword">if</span>(data_len &gt; src_block_size)</span><br><span class="line">        &#123;</span><br><span class="line">            data_len = src_block_size;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        size_t outlen = block_size;</span><br><span class="line">        OSStatus status = noErr;</span><br><span class="line">        status = SecKeyDecrypt(keyRef, kSecPaddingNone,</span><br><span class="line">                               srcbuf + idx, data_len,</span><br><span class="line">                               outbuf, &amp;outlen);</span><br><span class="line">        <span class="keyword">if</span> (status != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"SecKeyEncrypt fail. Error Code: %d"</span>, (<span class="keyword">int</span>)status);</span><br><span class="line">            ret = <span class="literal">nil</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> idxFirstZero = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">int</span> idxNextZero = (<span class="keyword">int</span>)outlen;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; outlen; i ++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (outbuf[i] == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (idxFirstZero &lt; <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        idxFirstZero = i;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        idxNextZero = i;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">NSUInteger</span> length = idxNextZero-idxFirstZero<span class="number">-1</span>;</span><br><span class="line">            [ret appendBytes:&amp;outbuf[idxFirstZero+<span class="number">1</span>] length:length];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    free(outbuf);</span><br><span class="line">    <span class="built_in">CFRelease</span>(keyRef);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - RSA Key File Encrypt/Decrypt Public Method</span></span><br><span class="line">+ (<span class="built_in">NSString</span> *)encryptString:(<span class="built_in">NSString</span> *)originString publicKeyPath:(<span class="built_in">NSString</span> *)publicKeyPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断originString参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((originString == <span class="literal">nil</span>) || (originString == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![originString isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([originString length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断publicKeyPath参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((publicKeyPath == <span class="literal">nil</span>) || (publicKeyPath == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![publicKeyPath isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([publicKeyPath length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取公钥对象和需要加密的字符串内容编码数据流</span></span><br><span class="line">    SecKeyRef publicKeyRef = [<span class="keyword">self</span> getPublicKeyRefWithFilePath:publicKeyPath];</span><br><span class="line">    <span class="built_in">NSData</span> *originData = [originString dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">    <span class="keyword">if</span> ([[<span class="keyword">self</span> <span class="keyword">class</span>] isEmptyKeyRef:(__bridge <span class="keyword">id</span>)(publicKeyRef)]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((originData == <span class="literal">nil</span>) || (originData == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![originData isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([originData length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//加密源字符串内容编码数据流的数据</span></span><br><span class="line">    <span class="built_in">NSData</span> *resultData = <span class="literal">nil</span>;</span><br><span class="line">    resultData = [<span class="keyword">self</span> encryptData:originData withKeyRef:publicKeyRef];</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> <span class="keyword">class</span>] base64EncodedStringWithData:resultData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSString</span> *)decryptString:(<span class="built_in">NSString</span> *)encryptString privateKeyPath:(<span class="built_in">NSString</span> *)privateKeyPath privateKeyPwd:(<span class="built_in">NSString</span> *)privateKeyPwd</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断encryptString参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((encryptString == <span class="literal">nil</span>) || (encryptString == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![encryptString isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([encryptString length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断publicKeyPath参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((privateKeyPath == <span class="literal">nil</span>) || (privateKeyPath == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![privateKeyPath isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([privateKeyPath length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断密码是否存在</span></span><br><span class="line">    <span class="built_in">NSString</span> *keyPassword = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@"</span>,privateKeyPwd];</span><br><span class="line">    <span class="keyword">if</span> ((privateKeyPwd == <span class="literal">nil</span>) || (privateKeyPwd == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        keyPassword = <span class="string">@""</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![privateKeyPwd isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        keyPassword = <span class="string">@""</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([privateKeyPwd length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        keyPassword = <span class="string">@""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取私钥对象和需要加密的字符串内容编码数据流</span></span><br><span class="line">    <span class="built_in">NSData</span> *encryptData = <span class="literal">nil</span>, *decryptData = <span class="literal">nil</span>;</span><br><span class="line">    SecKeyRef privateKeyRef = [<span class="keyword">self</span> getPrivateKeyRefWithFilePath:privateKeyPath</span><br><span class="line">                                                     keyPassword:privateKeyPwd];</span><br><span class="line">    encryptData = [[<span class="keyword">self</span> <span class="keyword">class</span>] base64DecodeDataWithString:encryptString];</span><br><span class="line">    <span class="keyword">if</span> ([[<span class="keyword">self</span> <span class="keyword">class</span>] isEmptyKeyRef:(__bridge <span class="keyword">id</span>)(privateKeyRef)]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((encryptData == <span class="literal">nil</span>) || (encryptData == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![encryptData isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([encryptData length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSStringEncoding</span> encoding = <span class="built_in">NSUTF8StringEncoding</span>;</span><br><span class="line">    decryptData = [<span class="keyword">self</span> decryptData:encryptData withKeyRef:privateKeyRef];</span><br><span class="line">    <span class="keyword">return</span> [[<span class="built_in">NSString</span> alloc] initWithData:decryptData encoding:encoding];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - RSA Key String Encrypt/Decrypt Public Method</span></span><br><span class="line">+ (<span class="built_in">NSData</span> *)encryptData:(<span class="built_in">NSData</span> *)originData publicKey:(<span class="built_in">NSString</span> *)publicKey</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断originData参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((originData == <span class="literal">nil</span>) || (originData == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![originData isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([originData length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断publicKeyPath参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((publicKey == <span class="literal">nil</span>) || (publicKey == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![publicKey isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([publicKey length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取需要加密的字符串内容编码数据流</span></span><br><span class="line">    SecKeyRef publicKeyRef = [<span class="keyword">self</span> publicKeyRefWithPublicKey:publicKey];</span><br><span class="line">    <span class="keyword">if</span>([[<span class="keyword">self</span> <span class="keyword">class</span>] isEmptyKeyRef:(__bridge <span class="keyword">id</span>)(publicKeyRef)])&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> encryptData:originData withKeyRef:publicKeyRef];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSString</span> *)encryptString:(<span class="built_in">NSString</span> *)originString publicKey:(<span class="built_in">NSString</span> *)publicKey</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断publicKey参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((publicKey == <span class="literal">nil</span>) || (publicKey == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![publicKey isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([publicKey length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断originString参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((originString == <span class="literal">nil</span>) || (originString == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![originString isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([originString length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取需要加密的字符串内容编码数据流</span></span><br><span class="line">    <span class="built_in">NSData</span> *originData = <span class="literal">nil</span>, *encryptData = <span class="literal">nil</span>;</span><br><span class="line">    SecKeyRef publicKeyRef = [<span class="keyword">self</span> publicKeyRefWithPublicKey:publicKey];</span><br><span class="line">    originData = [originString dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">    <span class="keyword">if</span>([[<span class="keyword">self</span> <span class="keyword">class</span>] isEmptyKeyRef:(__bridge <span class="keyword">id</span>)(publicKeyRef)])&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((originData == <span class="literal">nil</span>) || (originData == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![originData isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([originData length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    encryptData = [<span class="keyword">self</span> encryptData:originData withKeyRef:publicKeyRef];</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> <span class="keyword">class</span>] base64EncodedStringWithData:encryptData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSString</span> *)decryptString:(<span class="built_in">NSString</span> *)encryptString privateKey:(<span class="built_in">NSString</span> *)privateKey</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断publicKey参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((privateKey == <span class="literal">nil</span>) || (privateKey == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![privateKey isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([privateKey length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断originString参数是否正确</span></span><br><span class="line">    <span class="keyword">if</span> ((encryptString == <span class="literal">nil</span>) || (encryptString == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![encryptString isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([encryptString length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取私钥对象和需要加密的字符串内容编码数据流</span></span><br><span class="line">    SecKeyRef privateKeyRef;</span><br><span class="line">    <span class="built_in">NSData</span> *encryptData = <span class="literal">nil</span>, *decryptData = <span class="literal">nil</span>;</span><br><span class="line">    privateKeyRef = [[<span class="keyword">self</span> <span class="keyword">class</span>] privateKeyRefWithPrivateKey:privateKey];</span><br><span class="line">    encryptData = [[<span class="keyword">self</span> <span class="keyword">class</span>] base64DecodeDataWithString:encryptString];</span><br><span class="line">    <span class="keyword">if</span> ([[<span class="keyword">self</span> <span class="keyword">class</span>] isEmptyKeyRef:(__bridge <span class="keyword">id</span>)(privateKeyRef)]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((encryptData == <span class="literal">nil</span>) || (encryptData == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (![encryptData isKindOfClass:[<span class="built_in">NSData</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([encryptData length] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSStringEncoding</span> encoding = <span class="built_in">NSUTF8StringEncoding</span>;</span><br><span class="line">    decryptData = [<span class="keyword">self</span> decryptData:encryptData withKeyRef:privateKeyRef];</span><br><span class="line">    <span class="keyword">return</span> [[<span class="built_in">NSString</span> alloc] initWithData:decryptData encoding:encoding];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******************************************************************************/</span></span><br></pre></td></tr></table></figure>

<p>在iOS中RSA加解密使用方法介绍（RSA密钥格式请使用PKCS#8格式）</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用RSA执行加密操作</span></span><br><span class="line"><span class="built_in">NSString</span> *string4 = <span class="string">@"abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line"><span class="built_in">NSString</span> *encodeString4 = [RSAEncrypt encryptString:string4</span><br><span class="line">                                          publicKey:mPublicKey];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"encodeString4 : %@"</span>, encodeString4);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用RSA执行解密操作</span></span><br><span class="line"><span class="built_in">NSString</span> *decodeString4 = [RSAEncrypt decryptString:encodeString4</span><br><span class="line">                                         privateKey:mPrivateKey];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"decodeString4 : %@"</span>, decodeString4);</span><br></pre></td></tr></table></figure>
        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="https://nixzhang5.github.io">
            <img src="/img/avatar.jpg" alt="张新平">
            张新平
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Encryption/">Encryption</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://nixzhang5.github.io/加密.html&title=《加密》 — Xinping's Blog&pic=https://nixzhang5.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://nixzhang5.github.io/加密.html&title=《加密》 — Xinping's Blog&source=加密是为了保证我们的数据安全，即不被他人篡改或截取到有用的信息的操作。iOS一直以安全著称，但是从Xcode的Ghost事件之后，iOS安全不可摧的神话似..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://nixzhang5.github.io/加密.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《加密》 — Xinping's Blog&url=https://nixzhang5.github.io/加密.html&via=https://nixzhang5.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://nixzhang5.github.io/加密.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/App签名原理.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">App签名原理</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/AFNetWorking原理二.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">AFNetWorking原理(二) AFSecurityPolicy</h4>
      </a>
    </div>
  
</nav>



    




















</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>张新平 &copy; 2015 - 2019</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://nixzhang5.github.io/加密.html&title=《加密》 — Xinping's Blog&pic=https://nixzhang5.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://nixzhang5.github.io/加密.html&title=《加密》 — Xinping's Blog&source=加密是为了保证我们的数据安全，即不被他人篡改或截取到有用的信息的操作。iOS一直以安全著称，但是从Xcode的Ghost事件之后，iOS安全不可摧的神话似..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://nixzhang5.github.io/加密.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《加密》 — Xinping's Blog&url=https://nixzhang5.github.io/加密.html&via=https://nixzhang5.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://nixzhang5.github.io/加密.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAAB0ElEQVR42u3aQY4DIQxE0dz/0mQ7UgJd5QKHkT6rUdITHhvLXeb1ktf4sz4/mX07+9/PZzYvuHDhxtyxXLNn1p8rv6wc/suR4MKF28idVQylMNUQs99/sMGFC/dK7rr1WR9J+RYuXLj/kbt+jalR4MKFeyfXjTncYyTNEFy4cPu5ekp57u8j+S5cuHBL3GEud9CixyvS7nDhwm3h6gVl3ZS4cUmyL1y4cE9zR2npUWmt53ooYXDhwr2AW7uYpV/PMiRw4cJt4brhprtlfnXDmP/AhQt3E1cfbbojEDcQUfaFCxduD9cdoihxRj7biV6f4MKFuylnUM6kFJ3kUpcUvMKFC7eF6zY3OrQWreqtD1y4cE9zk6YkD1jtMgcXLtwWrl5ukoik9rr1UHHhwoV7jKsEH3pJchsahTutu3Dhwj3MrTUlSpCqFDX75QcuXLiNXCUKcV94khanmLvAhQs34A5z5YNYfXgDFy7cX3FPBKN6UVNKXnRnBC5cuAE3mcrqiCR4NaovXLhwt3JrExi3VCkV1M534cKFewF3lJZbOu3UBC5cuNdwN4xG3AgVLly4jVxlg1ppWzdAyvNw4cLt57qlRI9H3chDD2ThwoV7jPsGFK6vjq4cjIoAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>








<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '欢迎回来！';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
